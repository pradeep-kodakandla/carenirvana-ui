<div class="activity-container">
  <!-- LEFT: Alerts timeline -->
  <div class="activity-left">
    <div class="left-controls">
      <input type="text"
             placeholder="🔍 Search alerts/member/status…"
             [(ngModel)]="searchTerm"
             (input)="applyFilter()"
             class="search-input" />

      <div class="right-actions">
        <div class="sort-wrapper" (mouseenter)="showSort = true" (mouseleave)="showSort = false">
          <button class="sort-icon" type="button">⇅</button>
          <div class="sort-menu" *ngIf="showSort">
            <div class="sort-option" (click)="applySort('date_desc')">Newest first</div>
            <div class="sort-option" (click)="applySort('date_asc')">Oldest first</div>
            <div class="sort-option" (click)="applySort('name_asc')">Member (A–Z)</div>
            <div class="sort-option" (click)="applySort('name_desc')">Member (Z–A)</div>
            <div class="sort-option" (click)="applySort('status_asc')">Status (A–Z)</div>
            <div class="sort-option" (click)="applySort('status_desc')">Status (Z–A)</div>
          </div>
        </div>

        <!-- reserved for future "Add alert" (if you choose to create from UI) -->
        <!--<button class="add-btn" type="button" (click)="openFormForAdd()" disabled>➕ Add Alert</button>-->
      </div>
    </div>

    <div class="timeline-list">
      <div *ngFor="let a of filtered; trackBy: trackById"
           class="timeline-item"
           [class.selected]="a.memberAlertId === selectedId">
        <div class="timeline-content" (click)="editItem(a)">
          <div class="timeline-header">
            <div class="timeline-title">
              {{ a.cfgAlertName || ('Alert #' + a.alertId) }}
              <ng-container *ngIf="a.alertStatusName"> • <strong>{{ a.alertStatusName }}</strong></ng-container>
              <ng-container *ngIf="a.activeFlag === false"> • <em>Inactive</em></ng-container>
            </div>
            <span class="activity-actions" (click)="$event.stopPropagation()">
              <button type="button" class="icon-btn" title="Acknowledge" (click)="acknowledge(a)">✅</button>
              <button type="button" class="icon-btn" title="Dismiss" (click)="dismiss(a)">🗙</button>
              <!--<button type="button" class="icon-btn" title="Clear dates" (click)="clearDates(a)">🧹</button>-->
              <button type="button" class="icon-btn" title="Edit" (click)="editItem(a)">✏️</button>
            </span>
          </div>

          <div class="timeline-summary">
            <!--<strong>Member:</strong>
            {{ (a.memberLastName || '') + (a.memberFirstName ? ', ' + a.memberFirstName : '') || '—' }}-->
            • <strong>Date:</strong> {{ a.alertDate | date:'MM/dd/yyyy, h:mm a' }}
            <ng-container *ngIf="a.acknowledgedDate"> • <strong>Ack:</strong> {{ a.acknowledgedDate | date:'MM/dd/yyyy, h:mm a' }}</ng-container>
            <ng-container *ngIf="a.dismissedDate"> • <strong>Dismissed:</strong> {{ a.dismissedDate | date:'MM/dd/yyyy, h:mm a' }}</ng-container>
          </div>
        </div>
      </div>

      <!-- Empty state -->
      <div *ngIf="!loading && filtered.length === 0" class="timeline-item">
        <div class="timeline-content">
          <div class="timeline-header">
            <div class="timeline-title">No alerts found</div>
          </div>
          <div class="timeline-summary">Try a different search filter.</div>
        </div>
      </div>
    </div>

    <!-- Pager -->
    <div class="d-flex" style="gap:.5rem; margin-top:.5rem;">
      <button class="icon-btn" type="button" (click)="prevPage()" [disabled]="page<=1">⬅️ Prev</button>
      <div style="align-self:center;">Page {{ page }} • {{ total }} total</div>
      <button class="icon-btn" type="button" (click)="nextPage()" [disabled]="page*pageSize >= total">Next ➡️</button>
    </div>
  </div>

  <!-- RIGHT: Form / Summary -->
  <div class="activity-right">
    <ng-container *ngIf="selectedAlert; else summaryTpl">
      <div class="alert-details-card">
        <h3>{{ selectedAlert.cfgAlertName || ('Alert #' + selectedAlert.alertId) }}</h3>

        <div class="details-grid">
          <p><strong>Source:</strong> {{ selectedAlert.alertSourceName || '—' }}</p>
          <p><strong>Type:</strong> {{ selectedAlert.alertTypeName || '—' }}</p>
          <p><strong>Status:</strong> {{ selectedAlert.alertStatusCode || '—' }}</p>
          <p>
            <strong>Alert Date:</strong>
            {{ selectedAlert.alertDate ? (selectedAlert.alertDate | date:'MM/dd/yyyy, h:mm a') : '—' }}
          </p>
          <p>
            <strong>Acknowledged:</strong>
            {{ selectedAlert.acknowledgedDate ? (selectedAlert.acknowledgedDate | date:'MM/dd/yyyy, h:mm a') : '—' }}
          </p>
          <p>
            <strong>Dismissed:</strong>
            {{ selectedAlert.dismissedDate ? (selectedAlert.dismissedDate | date:'MM/dd/yyyy, h:mm a') : '—' }}
          </p>
        </div>

        <div class="actions">
          <button class="btn-primary" type="button" (click)="acknowledge(selectedAlert)">Acknowledge</button>
          <button class="btn-warn" type="button" (click)="dismiss(selectedAlert)">Dismiss</button>
          <button class="btn-outline" type="button" (click)="clearDates(selectedAlert)">Clear</button>
        </div>
      </div>

    </ng-container>

    <ng-template #summaryTpl>
      <div class="ai-summary">
        <h3>🔔 Alerts Summary</h3>
        <p><strong>Total:</strong> {{ total }}</p>
        <p><strong>Showing page:</strong> {{ page }}</p>
        <p><strong>Search:</strong> {{ searchTerm || '—' }}</p>
      </div>
    </ng-template>
  </div>

</div>

