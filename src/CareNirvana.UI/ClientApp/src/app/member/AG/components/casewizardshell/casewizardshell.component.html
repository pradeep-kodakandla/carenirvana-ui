<!-- Fixed shell layout -->
<div class="cw-shell">
  <div class="cw-top">

    <!-- Case Header -->
    <div class="caseWizardHeader card mb-2">
      <div class="card-body py-2">
        <div class="row g-2 align-items-end">

          <!-- Case Type -->
          <div class="col-12 col-md-4">
            <form [formGroup]="headerForm">
              <ui-smart-dropdown label="Select Case Type"
                                 placeholder="Select Case Type..."
                                 [options]="caseTypeOptions"
                                 formControlName="caseType"
                                 [disabled]="isCaseTypeLocked(aggregate$ | async)">
              </ui-smart-dropdown>
            </form>
          </div>

          <!-- Case meta + Save -->
          <div class="col-12 col-md-8">
            <div class="d-flex flex-wrap justify-content-md-end gap-3 align-items-end">

              <div class="small">
                <div class="text-muted">Case Number</div>
                <div class="fw-semibold">{{ getCaseNumber(aggregate$ | async) || '-' }}</div>
              </div>

              <div class="small">
                <div class="text-muted">Received Date</div>
                <div class="fw-semibold">
                  {{ getReceivedOn(aggregate$ | async) ? (getReceivedOn(aggregate$ | async) | date:'MM/dd/yyyy hh:mm a') : '-' }}
                </div>
              </div>

              <div class="small d-flex align-items-end gap-2">
                <div>
                  <div class="text-muted">Created On</div>
                  <div class="fw-semibold">
                    {{ getCreatedOn(aggregate$ | async) ? (getCreatedOn(aggregate$ | async) | date:'MM/dd/yyyy hh:mm a') : '-' }}
                  </div>
                </div>

                <button type="button"
                        class="btn btn-primary btn-sm"
                        (click)="saveFromTop()"
                        [disabled]="!headerForm.get('caseType')?.value || savingTop">
                  {{ savingTop ? 'Saving...' : 'Save' }}
                </button>
              </div>

            </div>
          </div>

        </div>
      </div>
    </div>
    <!-- Save banner (global) -->
    <div *ngIf="saveBannerText"
         class="cw-save-banner alert alert-success py-1 px-2 mb-2 d-flex align-items-center justify-content-between">
      <span>{{ saveBannerText }}</span>
      <button type="button" class="btn-close" aria-label="Close" (click)="clearSaveBanner()"></button>
    </div>

    <!-- Level Tabs -->
    <ul class="nav nav-tabs mb-2" *ngIf="(tabs$ | async) as tabs">
      <li class="nav-item" *ngFor="let t of tabs">
        <button class="nav-link"
                type="button"
                [class.active]="(activeLevelId$ | async) === t.levelId"
                (click)="selectLevel(t.levelId)">
          {{ t.title }}
        </button>
      </li>
    </ul>

    <caseChevronStepper [steps]="steps"
                        [activeStepId]="activeStepId"
                        (stepSelected)="onStepSelected($event)">
    </caseChevronStepper>

  </div>

  <!-- Scrollable content only -->
  <div class="cw-content caseWizardBody">
    <ng-template #stepContainer></ng-template>
  </div>
</div>
