<mat-menu #menu="matMenu">
  <button mat-menu-item><span>Add Activity</span></button>
  <button mat-menu-item><span>Run Assessment</span></button>
  <button mat-menu-item><span>Add Message</span></button>
  <button mat-menu-item><span>Add Notes</span></button>
  <button mat-menu-item><span>Upload Document</span></button>
</mat-menu>
<mat-menu #alertsMenu="matMenu" class="history-popover" yPosition="below" [overlapTrigger]="false" [hasBackdrop]="true" [backdropClass]="'cdk-overlay-dark-backdrop'" matMenuTriggerRestoreFocus="false">
  <div class="messages-wrap" (click)="$event.stopPropagation()">
    <app-member-alerts [showTable]="true"></app-member-alerts>
  </div>
</mat-menu>
<div style="display:flex;">
  <div class="sidebar" [class.collapsed]="isCollapse">
    <!-- Expand/Collapse Button -->
    <div class="sidebar-toolbar" [class.collapsed]="isCollapse">
      <!-- Menu (always visible) -->
      <button mat-icon-button
              class="toggle-button"
              aria-label="Menu"
              [matMenuTriggerFor]="menu">
        <mat-icon>menu</mat-icon>
      </button>

      <!-- Alerts (always visible) -->
      <button mat-icon-button
              class="toggle-button"
              aria-label="Alerts"
              #messagesTrigger="matMenuTrigger"
              [matMenuTriggerFor]="alertsMenu"
              (click)="openMessagesMenu(messagesTrigger)">
        <mat-icon aria-hidden="false" matBadge="{{member?.alertCount}}">notifications</mat-icon>
      </button>

      <!-- Spacer only when expanded -->
      <div class="flex-spacer" *ngIf="!isCollapse"></div>

      <!-- Collapse / Expand -->
      <button class="toggle-button collapse-toggle"
              (click)="toggleSidebar()"
              aria-label="Toggle member sidebar">
        <mat-icon>{{ isCollapse ? 'chevron_right' : 'chevron_left' }}</mat-icon>
      </button>
    </div>

    <!-- Collapsed member name (vertical) -->
    <div class="sidebar-collapsed-summary" *ngIf="isCollapse">
      <div class="collapsed-member-name"
           [attr.title]="(member?.firstName || '') + ' ' + (member?.lastName || '')">
        {{ member?.firstName }} {{ member?.lastName }} - ID: {{ member?.memberId }} · DOB: {{ member?.dob }} ({{ getAge(member?.dob) }} Yrs), {{ member?.gender }}
      </div>
    </div>


    <div class="sidebar-content" *ngIf="!isCollapse">
      <!-- Header -->
      <div class="member-card">
        <div class="member-avatar">
          {{ member?.firstName?.charAt(0) }}{{ member?.lastName?.charAt(0) }}
        </div>
        <div>
          <div class="member-name">{{ member?.firstName }} {{ member?.lastName }}</div>
          <div class="member-sub">
            ID: {{ member?.memberId }} · DOB: {{ member?.dob }} ({{ getAge(member?.dob) }} Yrs), {{ member?.gender }}
          </div>
        </div>
      </div>

      <!-- Enrollment & Risk -->
      <div class="section m-top-6">
        <div class="section-title">Enrollment</div>
        <span [ngClass]="member?.EndDate ? 'pill-red' : 'badge-green'">
          {{ getLevelValue(member?.levelMap, 'LOB') }}
          ({{ member?.endDate ? 'Inactive' : 'Active' }})
        </span>
      </div>

      <div class="section m-top-6">
        <div class="section-title">Risk Level</div>
        <div>
          <span class="risk-chip compact" [ngClass]="(member?.riskLevelCode || '').toLowerCase()">{{ member?.riskLevelCode || 'No Risk' }}</span>
        </div>
      </div>

      <!-- Programs -->
      <div class="section m-top-6" *ngIf="programsList.length">
        <div class="section-title">Programs</div>
        <span class="chip" *ngFor="let prog of programsList">{{ prog }}</span>
      </div>

      <!-- Contact Information -->
      <div class="section m-top-6">
        <div class="section-title">Contact Information</div>

        <div class="row">
          <mat-icon>call</mat-icon>
          <div>123-456-7890</div>
        </div>

        <div class="row">
          <mat-icon>mail</mat-icon>
          <div>test&#64;yahoo.com</div>
        </div>

        <div class="row">
          <mat-icon>location_on</mat-icon>
          <div>12345 Example Way<br />Sanfrancisco, CA 17050</div>
        </div>
      </div>

      <!-- Care Team -->
      <div class="section m-top-6">
        <div class="section-title">Care Team</div>

        <div class="team-row">
          <div class="team-role">Care Manager</div>
          <div class="team-name">{{loggedInUser}}</div>
        </div>

        <div class="team-row">
          <div class="team-role">PCP</div>
          <div class="team-name">N/A</div>
        </div>
      </div>

      <!-- Communication -->
      <div class="section m-top-6">
        <div class="section-title">Communication</div>

        <div class="team-row">
          <div class="team-role">Preferences</div>
          <div class="team-name">Phone and Email</div>
        </div>

        <div class="team-row">
          <div class="team-role">Language</div>
          <div class="team-name">English</div>
        </div>
      </div>
    </div>


    <!-- Show 'People' Icon when Collapsed -->
    <!--<div class="collapsed-icon" [matMenuTriggerFor]="menu" *ngIf="isCollapse">
      <mat-icon>menu</mat-icon>
    </div>-->
  </div>
  <div class="main-content">
    <div class="sidenav-content" style="padding-right:5px;">
      <!--<app-member [memberId]="memberId"></app-member>-->
      <router-outlet></router-outlet>
    </div>
  </div>
</div>
