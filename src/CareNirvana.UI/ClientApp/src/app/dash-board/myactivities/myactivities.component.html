<mat-menu #menu="matMenu">
  <button mat-menu-item><span>Add Activity</span></button>
  <button mat-menu-item disabled><span>Run Assessment</span></button>
  <button mat-menu-item><span>Messages</span></button>
  <button mat-menu-item><span>Add Notes</span></button>
  <button mat-menu-item disabled><span>Send Letter</span></button>
  <button mat-menu-item><span>Unassign</span></button>
  <button mat-menu-item><span>Summary</span></button>
</mat-menu>

<mat-drawer-container class="sidenav-container" style="padding:5px;" autosize>
  <mat-drawer-content mode="side" opened>

    <!-- Top bar: search + filter toggle + due chips (mirrors AssignedAuths) -->
    <div class="top-bar" style="display:flex;align-items:center;gap:10px;margin:8px 0;">
      <div class="search-section" style="display:flex;align-items:center;gap:8px;flex:1;">
        <input type="text"
               placeholder="ðŸ” Search activitiesâ€¦"
               (input)="onQuickSearch($event)"
               class="search-input"
               style="flex:1; padding:10px 12px; border:1px solid #e1e5ea; border-radius:10px; outline:none;" />
        <button class="filter-btn"
                type="button"
                (click)="toggleFilters()"
                title="Filters">
          <svg width="22" height="22" viewBox="0 0 24 24" aria-hidden="true">
            <path d="M3 5h18v2l-7 7v5l-4 2v-7L3 7z"></path>
          </svg>
        </button>
      </div>

      <div class="filters-col">
        <div class="chip-list">
          <button type="button" class="pill red" [class.active]="isDueSelected('OVERDUE')" (click)="setDueChip('OVERDUE')">
            <span class="dot red"></span> Over Due
            <span class="count">{{ overdueCount  }}</span>
          </button>
          <button type="button" class="pill amber" [class.active]="isDueSelected('TODAY')" (click)="setDueChip('TODAY')">
            <span class="dot amber"></span> Due today
            <span class="count">{{ dueTodayCount  }}</span>
          </button>
          <button type="button" class="pill green" [class.active]="isDueSelected('FUTURE')" (click)="setDueChip('FUTURE')">
            <span class="dot green"></span> Due in future
            <span class="count">{{ dueFutureCount }}</span>
          </button>
        </div>
      </div>
    </div>

    <!-- Filters panel (keep grid empty by request) -->
    <section class="filters-wrapper" *ngIf="showFilters" style="margin:8px 0;">
      <form [formGroup]="filtersForm" class="filters-panel"
            style="border:1px solid #e1e5ea;border-radius:12px;padding:12px;background:#fff;">
        <div class="filters-header" style="display:flex;justify-content:space-between;align-items:center;margin-bottom:10px;">
          <h3 style="margin:0;font-weight:600;">Filters</h3>
          <div style="display:flex;gap:8px;">
            <button type="button" (click)="toggleFilters()" class="close-btn"
                    style="border:0;border-radius:10px;padding:6px 12px;background:#6b7280;color:#fff;cursor:pointer;">
              Close
            </button>
          </div>
        </div>

        <!-- Empty grid placeholder to match layout patterns -->
        <div class="filters-grid" style="min-height:24px;"></div>
      </form>
    </section>

    <mat-drawer-container class="sidenav-container" autosize>
      <mat-drawer-content mode="side" opened>
        <div class="table-wrapper">
          <table mat-table [dataSource]="dataSource" matSort
                 multiTemplateDataRows
                 class="mat-elevation-z1 full-width-table pro-table mng-table">

            <!-- Module -->
            <ng-container matColumnDef="module">
              <th mat-header-cell *matHeaderCellDef mat-sort-header>Module</th>
              <td mat-cell *matCellDef="let row">
                <div class="status-cell">
                  {{ row.Module || '-' }}
                </div>
              </td>
            </ng-container>

            <!-- Member (FirstName LastName + ID) -->
            <ng-container matColumnDef="member">
              <th mat-header-cell *matHeaderCellDef mat-sort-header>Member</th>
              <td mat-cell *matCellDef="let row">
                <div class="name-cell">
                  <div class="sub-name">
                    <a href="#" (click)="onMemberClick(row.MemberId, (row.FirstName || '') + ' ' + (row.LastName || '')); $event.preventDefault()">
                      {{ (row.FirstName || '') + ' ' + (row.LastName || '') }}
                    </a>
                  </div>
                  <div class="sub-id">ID: {{ row.MemberId }}</div>
                </div>
              </td>
            </ng-container>

            <!--Auth Number -->
            <ng-container matColumnDef="authnumber">
              <th mat-header-cell *matHeaderCellDef mat-sort-header>Auth #</th>
              <td mat-cell *matCellDef="let row">
                <a href="#" (click)="onAuthClick(row.AuthNumber, row.MemberId, row.MemberDetailsId); $event.preventDefault()">
                  {{ row.AuthNumber }}
                </a>
              </td>
            </ng-container>

            <!-- Created On -->
            <ng-container matColumnDef="createdOn">
              <th mat-header-cell *matHeaderCellDef mat-sort-header>Created On</th>
              <td mat-cell *matCellDef="let row">{{ row.CreatedOn | date:'MM/dd/yyyy HH:mm:ss' }}</td>
            </ng-container>

            <!-- Refer To (username + id) -->
            <ng-container matColumnDef="referredTo">
              <th mat-header-cell *matHeaderCellDef mat-sort-header>Refer To</th>
              <td mat-cell *matCellDef="let row">
                <div>{{ row.UserName || '-' }}</div>
                <!--<div style="font-size:12px;color:#6b7280;">ID: {{ row.ReferredTo }}</div>-->
              </td>
            </ng-container>

            <!-- Activity Type -->
            <ng-container matColumnDef="activityType">
              <th mat-header-cell *matHeaderCellDef mat-sort-header>Activity Type</th>
              <td mat-cell *matCellDef="let row">{{ row.ActivityType || '-' }}</td>
            </ng-container>

            <!-- Follow Up Date -->
            <ng-container matColumnDef="followUpDate">
              <th mat-header-cell *matHeaderCellDef mat-sort-header>Follow Up Date</th>
              <td mat-cell *matCellDef="let row">{{ row.FollowUpDateTime | date:'MM/dd/yyyy HH:mm:ss' }}</td>
            </ng-container>

            <!-- Due Date with colors + days-left -->
            <ng-container matColumnDef="dueDate">
              <th mat-header-cell *matHeaderCellDef mat-sort-header>Due Date</th>
              <td mat-cell *matCellDef="let row">
                <span class="risk-chip compact" [ngClass]="getDueDateClass(row.DueDate)">
                  <div class="date-value">
                    {{ row.DueDate | date:'MM/dd/yyyy HH:mm:ss' }}
                  </div>
                  <div class="days-left">
                    {{ getDaysLeftLabel(row.DueDate) }}
                  </div>
                </span>
              </td>
            </ng-container>

            <!-- Status -->
            <ng-container matColumnDef="status">
              <th mat-header-cell *matHeaderCellDef mat-sort-header>Status</th>
              <td mat-cell *matCellDef="let row">{{ row.Status || '-' }}</td>
            </ng-container>

            <!-- Expanded placeholder (kept for parity) -->
            <ng-container matColumnDef="expandedDetail">
              <td mat-cell *matCellDef="let row" [attr.colspan]="displayedColumns.length">
              </td>
            </ng-container>

            <tr mat-header-row *matHeaderRowDef="displayedColumns"></tr>
            <tr mat-row *matRowDef="let row; columns: displayedColumns;"
                class="example-element-row"
                [class.example-expanded-row]="expandedElement === row"
                (click)="expandedElement = expandedElement === row ? null : row">
            </tr>
            <tr mat-row *matRowDef="let row; columns: ['expandedDetail']" class="example-detail-row"></tr>

            <tr class="mat-row" *matNoDataRow>
              <td class="mat-cell" [attr.colspan]="displayedColumns.length">No data</td>
            </tr>

          </table>

          <mat-paginator [pageSizeOptions]="[10, 25, 100]" aria-label="Select page"></mat-paginator>
        </div>
      </mat-drawer-content>

      <mat-drawer #drawer class="sidenav" style="width:22%;height:50%;align-content:center;" position="end" mode="side" opened="false">
      </mat-drawer>
    </mat-drawer-container>
  </mat-drawer-content>
</mat-drawer-container>
