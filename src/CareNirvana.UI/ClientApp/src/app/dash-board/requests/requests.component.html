<!-- â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
     REQUESTS COMPONENT â€” Redesigned Layout
     â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ -->
<!-- Context menu (unchanged) -->
<mat-menu #menu="matMenu">
  <button mat-menu-item><span>Add Activity</span></button>
  <button mat-menu-item disabled><span>Run Assessment</span></button>
  <button mat-menu-item><span>Messages</span></button>
  <button mat-menu-item><span>Add Notes</span></button>
  <button mat-menu-item disabled><span>Send Letter</span></button>
  <button mat-menu-item><span>Unassign</span></button>
  <button mat-menu-item><span>Summary</span></button>
</mat-menu>

<div class="req-shell">

  <!-- â”€â”€ TOP BAR: Search + Due chips â”€â”€ -->
  <div class="top-bar">
    <!-- Search + filter button -->
    <div class="search-section">
      <input type="text"
             placeholder="ðŸ” Search activitiesâ€¦"
             [value]="quickSearchTerm"
             (input)="onQuickSearch($event)"
             class="search-input" />
      <button class="filter-btn"
              type="button"
              (click)="toggleFilters()"
              title="Filters">
        <svg width="22" height="22" viewBox="0 0 24 24" aria-hidden="true">
          <path d="M3 5h18v2l-7 7v5l-4 2v-7L3 7z"></path>
        </svg>
      </button>
    </div>

    <!-- Due chips -->
    <div class="chip-list">
      <button type="button" class="pill red"
              [class.active]="isDueSelected('OVERDUE')"
              (click)="setDueChip('OVERDUE')">
        <span class="dot red"></span> Over Due
        <span class="count">{{ overdueCount }}</span>
      </button>
      <button type="button" class="pill amber"
              [class.active]="isDueSelected('TODAY')"
              (click)="setDueChip('TODAY')">
        <span class="dot amber"></span> Due today
        <span class="count">{{ dueTodayCount }}</span>
      </button>
      <button type="button" class="pill green"
              [class.active]="isDueSelected('FUTURE')"
              (click)="setDueChip('FUTURE')">
        <span class="dot green"></span> Due in future
        <span class="count">{{ dueFutureCount }}</span>
      </button>
    </div>
  </div>

  <!-- â”€â”€ FILTER BAR â”€â”€ -->
  <section class="filter-bar">

    <!-- Row 1: Module -->
    <div class="filter-row">
      <span class="filter-row__label">Module</span>
      <div class="filter-row__pills">
        <button type="button"
                *ngFor="let m of moduleFacets"
                class="mod-pill"
                [ngClass]="getModuleColorClass(m.key)"
                [class.active]="selectedModule === m.key"
                (click)="setModule(m.key)">
          <span class="mod-pill__dot"></span>
          {{ m.key }}
          <span class="mod-pill__count">{{ m.count }}</span>
        </button>
      </div>
    </div>

    <!-- Row 2: Type + Work Basket (only when module is selected) -->
    <div class="filter-row filter-row--contextual" *ngIf="selectedModule">

      <div class="sub-facet" *ngIf="typeFacets.length">
        <span class="filter-row__label">Type</span>
        <div class="filter-row__pills">
          <button type="button"
                  *ngFor="let t of typeFacets"
                  class="chip-pill"
                  [class.active]="selectedSubType === t.key"
                  (click)="setSubType(t.key)">
            {{ t.label }}
            <span class="chip-pill__count">{{ t.count }}</span>
          </button>
        </div>
      </div>

      <div class="sub-facet" *ngIf="basketFacets.length">
        <span class="filter-row__label">Work Basket</span>
        <div class="filter-row__pills">
          <button type="button"
                  *ngFor="let b of basketFacets"
                  class="chip-pill"
                  [class.active]="selectedWorkBasket === b.key"
                  (click)="setWorkBasket(b.key)">
            {{ b.label }}
            <span class="chip-pill__count">{{ b.count }}</span>
          </button>
        </div>
      </div>
    </div>

    <!-- Row 3: Work Group -->
    <!--<div class="filter-row" *ngIf="workGroups?.length">
      <span class="filter-row__label">Work Group</span>
      <div class="filter-row__pills">
        <button type="button"
                class="chip-pill"
                [class.active]="selectedWorkGroupId === null"
                (click)="onWorkGroupChipClick(null)">
          All
        </button>
        <button type="button"
                *ngFor="let wg of workGroups"
                class="chip-pill"
                [class.active]="selectedWorkGroupId === wg.workGroupId"
                (click)="onWorkGroupChipClick(wg.workGroupId)">
          {{ wg.workGroupName }}
        </button>
      </div>
    </div>-->
  </section>

  <!-- â”€â”€ ACTIVE FILTER CHIPS â”€â”€ -->
  <div class="active-chips-row" *ngIf="hasActiveFilters()">
    <span class="active-chips-label">Active filters:</span>

    <!-- search term chip -->
    <button *ngIf="quickSearchTerm"
            class="active-chip"
            type="button"
            (click)="clearSearch()">
      Search: "{{ quickSearchTerm }}"
      <mat-icon class="active-chip__x">close</mat-icon>
    </button>

    <!-- filter chips -->
    <button *ngFor="let chip of getActiveFilters()"
            class="active-chip"
            type="button"
            (click)="clearSingleFilter(chip.key)">
      {{ chip.label }}
      <mat-icon class="active-chip__x">close</mat-icon>
    </button>

    <button class="clear-all-btn" type="button" (click)="clearAllFilters()">
      Clear all
    </button>
  </div>

  <!-- â”€â”€ TABLE VIEW â”€â”€ -->
  <section class="table-section">
    <div class="table-wrapper">
      <table mat-table [dataSource]="dataSource" matSort
             multiTemplateDataRows
             class="req-table">

        <!-- Module -->
        <ng-container matColumnDef="module">
          <th mat-header-cell *matHeaderCellDef mat-sort-header>Module</th>
          <td mat-cell *matCellDef="let row">
            <span class="mod-badge"
                  [ngClass]="getModuleColorClass(row.module)">
              {{ row.module || 'â€”' }}
            </span>
          </td>
        </ng-container>

        <!-- Member -->
        <ng-container matColumnDef="member">
          <th mat-header-cell *matHeaderCellDef mat-sort-header>Member</th>
          <td mat-cell *matCellDef="let row">
            <div class="member-cell">
              <a class="member-cell__name"
                 href="#"
                 (click)="onMemberClick(row.memberId, fullName(row)); $event.preventDefault()">
                {{ fullName(row) }}
              </a>
              <span class="member-cell__id">{{ row.memberId }}</span>
            </div>
          </td>
        </ng-container>

        <!-- Auth / Case # -->
        <ng-container matColumnDef="authnumber">
          <th mat-header-cell *matHeaderCellDef mat-sort-header>#</th>
          <td mat-cell *matCellDef="let row">
            <a *ngIf="row.authNumber"
               class="auth-link"
               href="#"
               (click)="onAuthClick(row.authNumber, row.memberId, row.memberDetailsId); $event.preventDefault()">
              {{ row.authNumber }}
            </a>
            <span *ngIf="!row.authNumber" class="text-muted">â€”</span>
          </td>
        </ng-container>

        <!-- Sub Type -->
        <ng-container matColumnDef="subType">
          <th mat-header-cell *matHeaderCellDef>Type</th>
          <td mat-cell *matCellDef="let row">
            <span class="text-secondary">{{ getRowSubType(row) }}</span>
          </td>
        </ng-container>

        <!-- Activity Type -->
        <ng-container matColumnDef="activityType">
          <th mat-header-cell *matHeaderCellDef mat-sort-header>Activity</th>
          <td mat-cell *matCellDef="let row">{{ row.activityType || 'â€”' }}</td>
        </ng-container>

        <!-- Work Basket -->
        <ng-container matColumnDef="workBasket">
          <th mat-header-cell *matHeaderCellDef mat-sort-header>Work Basket</th>
          <td mat-cell *matCellDef="let row">
            <span class="text-secondary">{{ row.workBasketName || 'â€”' }}</span>
          </td>
        </ng-container>

        <!-- Referred To -->
        <ng-container matColumnDef="referredTo">
          <th mat-header-cell *matHeaderCellDef mat-sort-header>Referred To</th>
          <td mat-cell *matCellDef="let row">{{ row.userName || 'â€”' }}</td>
        </ng-container>

        <!-- Due Date -->
        <ng-container matColumnDef="dueDate">
          <th mat-header-cell *matHeaderCellDef mat-sort-header>Due Date</th>
          <td mat-cell *matCellDef="let row">
            <span class="due-badge" [ngClass]="getDueDateClass(row.dueDate)">
              <span class="due-badge__date">{{ row.dueDate | date:'MMM d, y' }}</span>
              <span class="due-badge__label">{{ getDaysLeftLabel(row.dueDate) }}</span>
            </span>
          </td>
        </ng-container>

        <!-- Status -->
        <ng-container matColumnDef="status">
          <th mat-header-cell *matHeaderCellDef mat-sort-header>Status</th>
          <td mat-cell *matCellDef="let row">
            <span class="status-chip" [attr.data-status]="(row.status || '').toLowerCase()">
              {{ row.status || 'â€”' }}
            </span>
          </td>
        </ng-container>

        <!-- Actions -->
        <ng-container matColumnDef="actions">
          <th mat-header-cell *matHeaderCellDef></th>
          <td mat-cell *matCellDef="let row" class="actions-cell">
            <div class="action-group">
              <button mat-icon-button
                      class="action-btn action-btn--accept"
                      matTooltip="Accept"
                      (click)="onAccept(row); $event.stopPropagation()">
                <mat-icon>check_circle</mat-icon>
              </button>
              <button mat-icon-button
                      class="action-btn action-btn--reject"
                      matTooltip="Reject"
                      (click)="onReject(row); $event.stopPropagation()">
                <mat-icon>cancel</mat-icon>
              </button>
              <button mat-icon-button
                      class="action-btn action-btn--view"
                      matTooltip="View"
                      (click)="onView(row); $event.stopPropagation()">
                <mat-icon>visibility</mat-icon>
              </button>
            </div>
          </td>
        </ng-container>

        <!-- Expanded row placeholder -->
        <ng-container matColumnDef="expandedDetail">
          <td mat-cell *matCellDef="let row" [attr.colspan]="displayedColumns.length"></td>
        </ng-container>

        <!-- Row defs -->
        <tr mat-header-row *matHeaderRowDef="displayedColumns"></tr>
        <tr mat-row
            *matRowDef="let row; columns: displayedColumns;"
            class="data-row"
            [class.expanded-row]="expandedElement === row"
            (click)="expandedElement = expandedElement === row ? null : row">
        </tr>
        <!--<tr mat-row *matRowDef="let row; columns: ['expandedDetail']"
            class="detail-row"></tr>-->

        <!-- Empty state -->
        <tr class="mat-row" *matNoDataRow>
          <td class="mat-cell empty-state" [attr.colspan]="displayedColumns.length">
            <div class="empty-state__inner">
              <mat-icon class="empty-state__icon">inbox</mat-icon>
              <div class="empty-state__title">No requests match your filters</div>
              <div class="empty-state__sub">Try adjusting your search or filter criteria</div>
              <button *ngIf="hasActiveFilters()"
                      class="empty-state__btn"
                      type="button"
                      (click)="clearAllFilters()">
                Clear all filters
              </button>
            </div>
          </td>
        </tr>

      </table>

      <mat-paginator [pageSizeOptions]="[10, 25, 100]"
                     showFirstLastButtons
                     aria-label="Select page">
      </mat-paginator>
    </div>
  </section>

</div>
