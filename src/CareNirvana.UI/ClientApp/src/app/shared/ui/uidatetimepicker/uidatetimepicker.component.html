<div class="ui-dt d-flex align-items-center gap-2"
     [class.disabled]="isDisabled">
  <!-- Click anywhere here opens picker (click)="onFieldClick($event)"-->
  <div class="input-group w-100 position-relative">

    <!-- Visible text input -->
    <input type="text"
           class="form-control"
           [placeholder]="dateOnly ? placeholderDate : placeholderDateTime"
           [disabled]="isDisabled"
           [value]="displayValue"
           (focus)="startEdit()"
           (input)="onTextInput($any($event.target).value)"
           (keydown.enter)="commitText()"
           (blur)="commitText()"
           (click)="$event.stopPropagation(); " />

    <!-- Calendar button: NOT in tab order onFieldClick($event)-->
    <button type="button"
            class="btn btn-outline-secondary"
            tabindex="-1"
            aria-hidden="true"
            (mousedown)="$event.preventDefault()"
            (click)="openPicker(); $event.stopPropagation()"
            [disabled]="isDisabled"
            title="Open calendar">
      ðŸ“…
    </button>

    <!-- Hidden native picker input (never tabbable) -->
    <div class="picker-anchor">
      <input #pickerInput
             class="native-picker"
             tabindex="-1"
             [type]="dateOnly ? 'date' : 'datetime-local'"
             [disabled]="isDisabled"
             [value]="dateOnly ? dateStr : datetimeStr"
             (change)="onNativePickerChange($any($event.target).value)"
             [attr.step]="dateOnly ? null : 1"
             [attr.min]="min ? (dateOnly ? toDateInputValue(min) : toDatetimeLocalValue(min)) : null"
             [attr.max]="max ? (dateOnly ? toDateInputValue(max) : toDatetimeLocalValue(max)) : null" />
    </div>
  </div>
</div>
