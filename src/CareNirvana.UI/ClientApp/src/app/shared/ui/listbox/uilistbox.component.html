<!-- ui-listbox.component.html -->
<div class="ui-field" [style.width]="width">

  <label *ngIf="label" class="ui-field__static-label">
    {{ label }}
    <span *ngIf="required" class="ui-field__required"></span>
    <span *ngIf="optional" class="ui-field__optional">(optional)</span>
  </label>

  <div class="ui-listbox"
       [class.ui-listbox--error]="hasError"
       [class.ui-listbox--disabled]="disabled"
       [style.height]="height"
       role="listbox"
       [attr.aria-label]="ariaLabel || label"
       [attr.aria-required]="required"
       [attr.aria-multiselectable]="multiple"
       tabindex="0"
       (keydown)="onKeydown($event)"
       (blur)="onBlur()">

    <input *ngIf="searchable"
           class="ui-listbox__search"
           type="text"
           [placeholder]="searchPlaceholder"
           [(ngModel)]="searchTerm"
           (ngModelChange)="onSearchChange($event)"
           aria-label="Filter list" />

    <div class="ui-listbox__options">
      <div *ngFor="let opt of filteredOptions; let i = index; trackBy: trackByValue"
           class="ui-listbox__option"
           [class.ui-listbox__option--selected]="isSelected(opt)"
           [class.ui-listbox__option--highlighted]="i === highlightedIndex"
           [class.ui-listbox__option--disabled]="opt.disabled"
           role="option"
           [attr.aria-selected]="isSelected(opt)"
           [attr.aria-disabled]="opt.disabled"
           [attr.title]="opt.label"
           (click)="optionClick(opt)">
        <span *ngIf="multiple" class="ui-listbox__check" aria-hidden="true">
          {{ isSelected(opt) ? '☑' : '☐' }}
        </span>
        <span class="ui-listbox__label">{{ opt.label }}</span>
        <span *ngIf="opt.description" class="ui-listbox__desc">{{ opt.description }}</span>
      </div>

      <div *ngIf="filteredOptions.length === 0" class="ui-panel__empty">
        {{ noResultsText }}
      </div>
    </div>
  </div>

  <div *ngFor="let msg of messages" class="ui-field__message"
       [class.ui-field__message--error]="msg.type === 'error'"
       [class.ui-field__message--hint]="msg.type === 'hint'" role="alert">
    {{ msg.text }}
  </div>
</div>
